<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ノート一覧</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
         body { margin: 0; padding: 0; background: linear-gradient(120deg, #f7f8fc 60%, #e4eaff 100%); font-family: 'Inter', 'Noto Sans JP', sans-serif; color: #222; min-height: 100vh; position: relative; }
            .top-bar { display: flex; justify-content: space-between; align-items: flex-start; width: 100%; max-width: 1400px; margin: 2.5rem auto 0 auto; padding: 0 2rem; box-sizing: border-box; position: relative; z-index: 10; }
            .note-back-btn { background: #fff; border: none; color: #857be7; font-size: 1.1rem; display: flex; align-items: center; gap: .45em; font-weight: 600; cursor: pointer; padding: 0.3em 1.3em 0.3em 0.3em; border-radius: 5px; transition: background .14s, color .14s; box-shadow: 0 2px 8px rgba(130,120,250,0.05); }
            .note-back-btn:hover { background: #f4f3fd; color: #594cf5; }
            .top-bar-right { display: flex; gap: 0.9em; }
            .btn { display: inline-flex; align-items: center; gap: 0.35em; border: none; border-radius: 6px; padding: 0.55em 1.3em; font-weight: 600; font-size: 1rem; cursor: pointer; background: none; transition: background 0.15s, color 0.15s; box-shadow: 0 1px 4px rgba(108,99,255,0.08); }
            .btn-save { background: #6c63ff; color: #fff; }
            .btn-save:hover { background: #594cf5; }
            .btn-delete { background: #fff1f1; color: #d64242; border: 1px solid #fad1d1; }
            .btn-delete:hover { background: #ffd6d6; color: #ab1d1d; }
            .btn-ghost { background: none; color: #6c63ff; box-shadow: none; padding: 0.4em; font-size: 1.2rem; }
            .btn-ghost:hover { background: #f4f3fd; color: #594cf5; }
            .main-content { display: flex; gap: 2.4rem; max-width: 1400px; margin: 1.5rem auto 0 auto; padding: 0 2rem 2rem 2rem; min-height: 80vh; align-items: flex-start; }
            .editor-section { flex: 1 1 0; background: #fff; border-radius: 18px; box-shadow: 0 4px 24px rgba(120,120,180,0.09); padding: 2.5rem 2.5rem 2.3rem 2.5rem; min-width: 0; }
            .note-title-bar { border-bottom: 2px solid #eceafd; margin-bottom: 1.3em; padding-bottom: 0.7em; }
            .note-title-input { font-size: 2.1rem; font-weight: 700; border: none; background: transparent; outline: none; color: #222243; width: 100%; letter-spacing: 0.02em; }
            .note-title-input::placeholder { color: #b6b8d1; font-weight: 400; font-size: 1.2rem; }
            .welcome-message { display: flex; flex-direction: column; align-items: center; color: #888; text-align: center; }
            .welcome-icon { font-size: 1.5em; margin-bottom: 0.6em; color: #6c63ff; }
            .welcome-features { display: flex; gap: 1.15em; margin-top: 0.9em; flex-wrap: wrap; justify-content: center; }
            .feature-item { display: flex; align-items: center; gap: 0.35em; color: #bbb; font-size: 0.98em; }
            .search-btn { background: #6c63ff; color: #fff; border: none; padding: 0.7em 1em; border-radius: 7px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
            .search-btn:hover { background: #594cf5; }
            .search-input-wrapper { display: flex; gap: 0.4rem; margin-bottom: 0.7rem; }
            .search-input { font-size: 1em; padding: 0.5em 1em; border-radius: 7px; border: 1px solid #eceafd; background: #fff; outline: none; transition: border 0.18s; }
            .search-input:focus { border: 1.5px solid #6c63ff; }
        #hyou:hover {
            background-color: #edf1fe;
            cursor: pointer;
        }
        #toast {
        position: fixed; right: 32px; bottom: 32px;
        min-width: 180px;
        background: rgba(50,50,75,0.95);
        color: #fff;
        font-weight: 600;
        border-radius: 9px;
        box-shadow: 0 6px 20px rgba(60,45,100,0.14);
        padding: 1em 1.7em;
        font-size: 1.08rem;
        text-align: center;
        z-index: 10000;
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition: opacity 0.4s, visibility 0s 0.4s;
        }
        #toast.is-visible {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
        transition: opacity 0.4s;
        }
        .modal-outer { display: none; position: fixed; left:0; top:0; width:100vw; height:100vh; background: rgba(40,30,55,0.17); z-index:99999; align-items: center; justify-content: center; }
        .modal-outer.is-visible { display: flex; }
        .modal-inner { background:#fff; border-radius:15px; min-width:320px; max-width:96vw; box-shadow:0 6px 28px rgba(80,60,130,0.12); padding:2.1em 2em 1.3em 2em; margin:auto; position:relative; }
        .modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.3em; }
        .modal-title { font-size: 1.22rem; font-weight: 700; color: #6c63ff; }
        .modal-form-group { margin-bottom: 1.1em; }
        .modal-label { font-weight: 600; color: #594cf5; display: block; margin-bottom: 0.3em; }
        .modal-select, .modal-textarea { padding: 0.7em 0.7em; border-radius: 7px; border: 1px solid #eceafd;}
        .modal-textarea { resize: vertical; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 1em; margin-top: 2em; }
    </style>
</head>
<body style="margin: 0; padding: 0;">
    <div style="max-width: 90%; margin: 0 auto; padding: 0 32px; box-sizing: border-box;">
        <h1>ノート一覧</h1>
        <!-- 検索フォーム -->
        <form method="post" style="display: flex; align-items: center; width: 100%; box-sizing: border-box; position: relative;">
            <!-- 検索入力欄 -->
            <input type="text" class="search-input" id="searchword" name="searchword" placeholder="ノートを検索（タイトル・内容）" value="{{ searchword }}";
                style="width: 40%; min-width: 150px; max-width: 50%; font-size: 1.2em; padding-right: 2em; background-color: #fff;"
                oninput="clearbutton()">
            <!-- 入力クリアボタン -->
            <button type="button" id="clear-btn" onclick="clearsearch()"
                style="display: none; position: absolute; right: 56%; top: 50%; transform: translateY(-50%); border: none; background: transparent; font-size: 1.2em; cursor: pointer;">✕</button>
            <!-- 検索ボタン -->
            <button type="submit" class="search-btn" style="font-size: 1.0em; margin-left: 1%;"><i class="fas fa-search"></i></button>
            <!-- 並び順プルダウン -->
            <select name="order" class="modal-select" style="margin-left: 2%; font-size: 1.0em; background-color: #fff" onchange="this.form.submit()">
                {% for o in orders %}
                    <option value="{{ o }}" {% if o == order %}selected{% endif %}>{{ o }}</option>
                {% endfor %}
            </select>
            <!-- 右寄せ用スペース -->
            <span style="flex: 1;"></span>
            <!-- 新規ノート作成ボタン -->
            <button type="button" id="create-note-btn" class="btn btn-save" style="font-size: 1.0em; margin-right: 0%;">＋ 新規ノート</button>
        </form>
        <!-- ノート件数表示 -->
        <p style="margin: 8px 0 0 0;">
            {{ len }}件のノート
        </p>
        {% if len>0 %}
        <!-- ノート一覧テーブル -->
        <table class="editor-section" style="border: none; margin-top: 24px; width: 100%; border-collapse: collapse;" cellpadding="8" cellspacing="0">
            <thead>
                <tr>
                    <!-- タイトル列 -->
                    <th style="text-align: left; padding-left: 5%;">タイトル</th>
                    <!-- 最終更新日列 -->
                    <th style="text-align: left; padding-left: 20%;">最終更新日</th>
                    <!-- 操作列 -->
                    <th></th>
                </tr>
            </thead>
            <today>
            {% for note in notes: %}
            <tr id="hyou" onclick="location.href='/note/{{ note.num }}'">
                    <td style="text-align: left; padding-left: 5%;" >{{ note.title }}</td>
                    <td style="text-align: left; padding-left: 20%;">{{ note.update_time.strftime('%Y年%m月%d日') }}</td>
                    <td style="text-align: center;">
                        <!-- ノート一覧テーブル内の削除ボタン -->
                        <button type="button"
                            onclick="event.stopPropagation(); confirmDeleteCustom('{{ note.num }}', '{{ note.title|e }}')"
                            class="btn btn-delete" style="font-size: 1.0em;"><i class="fas fa-trash-alt"></i></button>
                    </td>
            </tr>
            {% endfor %}
            </today>
        </table>
        {% endif %}
        <!-- ノートがない場合のメッセージ -->
        {% if len==0 %}
            <p style="text-align: center; color: #999; margin-top: 24px;">ノートがありません</p>
        {% endif %}
    </div>

   <!-- 削除確認モーダル -->
    <div id="remove-confirm-modal" class="modal-outer">
    <div class="modal-inner">
      <div class="modal-header">
        <span class="modal-title" style="color: #d64242;"><i class="fas fa-exclamation-triangle"></i> ノートを削除</span>
      </div>
      <div class="modal-body">
        <p style="margin: 1em 0 2em; line-height: 1.6;">
          本当に「<span id="modal-note-title"></span>」を削除しますか？<br>この操作は元に戻すことはできません。
        </p>
      </div>
      <div class="modal-actions">
        <button type="button" onclick="closeModal(false)" class="btn btn-ghost" id="cancel-delete-btn">キャンセル</button>
        <button type="button" onclick="closeModal(true)" class="btn btn-delete" id="confirm-remove-btn">削除する</button>
      </div>
    </div>
  </div>
  
   <!-- トースト通知 -->
    <div id="toast" style="display:none; position:fixed; bottom:40px; left:50%; transform:translateX(-50%); background:#323232; color:#fff; padding:16px 32px; border-radius:8px; font-size:1.1em; z-index:2000; box-shadow:0 2px 8px rgba(0,0,0,0.2);">
        削除しました
    </div>

    <script>
    document.getElementById('create-note-btn').addEventListener('click', function() {
      fetch('/note/create', { method: 'POST' })
        .then(res => res.json())
        .then(data => {
          // 作成後、そのノートの編集画面へ移動
          window.location.href = '/note/' + data.note_id;
        });
    });
    
    function clearbutton(){
        const searchWord = document.getElementById('searchword').value;
        document.getElementById('clear-btn').style.display = searchWord ? 'block' : 'none';
    }

    function clearsearch() {
        document.getElementById('searchword').value = '';
        clearbutton();
        document.querySelector('form').submit(); //空にして送信
    }
   
// 削除確認モーダルを表示
function confirmDeleteCustom(id, title) {
    document.getElementById('remove-confirm-modal').style.display = 'flex';
    document.getElementById('modal-note-title').textContent = title;
    document.getElementById('confirm-remove-btn').onclick = function() {
        fetch('/remove', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: 'id=' + encodeURIComponent(id)
        }).then(() => {
            location.reload();
            showToast('削除しました');
            });
        closeModal();
    };
}

// モーダルを閉じる
function closeModal() {
    document.getElementById('remove-confirm-modal').style.display = 'none';
}

// トースト表示関数
function showToast(message) {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.style.display = 'block';
    setTimeout(() => window.location.href = '/', 1200);
}

    clearbutton();
    
    </script>
</body>
</html>