<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>設定画面</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="custom-page {{ 'light-mode' if current_user.mode_flag == 1 else 'dark-mode' }}">
    <header>
            {% include "header.html" %}
    </header>
    <script> /*ヘッダーの色変更js*/
        if (window.location.pathname.includes("custom")) {
        document.querySelector(".setting-actions").style.backgroundColor = "#d6a9ca";
        document.querySelector(".setting-link").style.color = "#a5229c";
        }
    </script>
    <div class="custom-title">
        <a href="{{ url_for('index') }}" class="back-link">戻る</a>
        <h1>⚙️設定</h1>
    </div>
    <main class="custom-page">
        <section class="user-info">
            <h2 class="custom-page">ユーザー情報</h2>
            <p class="custom-page">現在ログインしているユーザーの情報です</p>
            <p class="custom-page">ユーザーID</p>
            <p class="custom-page"><strong>{{ current_user.user_id }}</strong></p>
            <a href="{{ url_for('changePassword') }}">
                <span class="pathward-chenge-link">パスワードを変更</span>
            </a>
        </section>

        <section class="theme-setting">
            <h2 class="custom-page">テーマ設定</h2>
            <p class="custom-page">アプリの表示テーマを設定できます</p>
            <div class="form-group">
                <label for="theme-select">テーマ</label>
                <select id="theme" name="mode_flag">
                    <option value="1" {% if current_user.mode_flag == 1 %}selected{% endif %}>ライトモード</option>
                    <option value="0" {% if current_user.mode_flag == 0 %}selected{% endif %}>ダークモード</option>
                </select>
            </div>
        </section>

        <section class="AI-setting">
            <h2 class="custom-page">AI設定(デフォルト)</h2>
            <p class="custom-page">AI機能の出力形式や出力レベルを設定できます</p>
            <div class="form-group">
                <label for="response-mode">AI出力フォーマット</label>
                <select id="response-mode" name="ai_answer_flag" >
                    <option value="0" {% if current_user.ai_answer_flag == 0 %}selected{% endif %}>シンプル</option>
                    <option value="1" {% if current_user.ai_answer_flag == 1 %}selected{% endif %}>詳細</option>
                    <option value="2" {% if current_user.ai_answer_flag == 2 %}selected{% endif %}>箇条書き</option>
                </select>
                <label for="response-level">出力レベル</label>
                <select id="response-level" name="ai_level_flag">
                    <option value="0" {% if current_user.ai_level_flag == 0 %}selected{% endif %}>初級</option>
                    <option value="1" {% if current_user.ai_level_flag == 1 %}selected{% endif %}>中級</option>
                    <option value="2" {% if current_user.ai_level_flag == 2 %}selected{% endif %}>上級</option>
                </select>
            </div>
        </section>
        
        <div class="button-group">
            <button id="logout-btn">ログアウト</button>
            <button id="save-setting">設定を保存</button>
        </div>
    </main>


<script>
    document.getElementById("logout-btn").addEventListener("click", function() {
        if (confirm("本当にログアウトしますか？")) {
            window.location.href = "/logout";
        }
    });
</script>

<script>
document.getElementById('theme').addEventListener('change', function () {
    const mode = this.value;
    document.body.classList.toggle('dark-mode', mode === "0");
    document.body.classList.toggle('light-mode', mode === "1");
});

document.getElementById('save-setting').addEventListener('click', function () {
    const mode_flag = document.getElementById('theme').value;
    const ai_answer_flag = document.getElementById('response-mode').value;
    const ai_level_flag = document.getElementById('response-level').value;

    fetch('/custom', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            mode_flag: parseInt(mode_flag),
            ai_answer_flag: parseInt(ai_answer_flag),
            ai_level_flag: parseInt(ai_level_flag)
        })
    });
});
</script>
</body>
</html>